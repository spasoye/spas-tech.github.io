{{ $user   := .Get "user" | default "spasoye" }}
{{ $repo   := .Get "repo" }}
{{ $branch := .Get "branch" | default "master" }}

{{ if not $repo }}{{ return }}{{ end }}

{{ $base := printf "https://raw.githubusercontent.com/%s/%s/%s" $user $repo $branch }}
{{ $url  := printf "%s/README.md" $base }}

{{ with resources.GetRemote $url (dict "headers" (dict "User-Agent" "Hugo")) }}
  {{ with .Content }}
    {{/* Fix markdown images - match any path that doesn't start with http:// or https:// */}}
    {{ $fixed := . | replaceRE `!\[([^\]]*)\]\(([^:)]+)\)` (printf `![$1](%s/$2?raw=true)` $base) }}
    
    {{/* Restore markdown images that were actually http/https */}}
    {{ $fixed = $fixed | replaceRE (printf `%s/(https?://[^)]+)` $base) `$1` }}
    
    {{/* Fix HTML img tags with relative src paths - now allows spaces in the path */}}
    {{ $fixed = $fixed | replaceRE `(<img[^>]+src=")([^":]+)\s*("[^>]*>)` (printf `${1}%s/${2}?raw=true${3}` $base) }}
    
    {{/* Restore HTML img tags that were actually http/https */}}
    {{ $fixed = $fixed | replaceRE (printf `src="%s/(https?://[^"]+\?raw=true)"` $base) `src="$1"` }}
    
    {{ $html  := $fixed | $.Page.RenderString (dict "markup" "markdown") }}

    <div class="github-readme markdown-body">
      {{ $html | safeHTML }}
    </div>

    {{/* GitHub's exact markdown CSS (2025 version) */}}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <style>
      .github-readme {
        background: var(--color-canvas-default, #0d1117);
        color: var(--color-fg-default, #c9d1d9);
        padding: 2rem;
        border-radius: 12px;
        margin: 1rem 0;
        overflow-x: auto;
      }
      .github-readme img { max-width: 100%; height: auto; border-radius: 8px; }
      .github-readme pre, .github-readme code { border-radius: 6px; }
      .github-readme table { border-collapse: collapse; width: 100%; }
      .github-readme table th, .github-readme table td {
        border: 1px solid #30363d;
        padding: 8px 13px;
      }
      .github-readme a { color: #58a6ff; }
      .github-readme h1, .github-readme h2, .github-readme h3 { 
        border-bottom: none;
        color: #4CAF50;
      }
      /* PARAGRAPH FONT â€” change font family, size, line-height, color */
      .github-readme p {
        font-family: "Inter", system-ui, sans-serif;
        font-size: 1.05rem;
        line-height: 1.7;
        color: #e2e8f0;
        margin: 1.2rem 0;
      }
      .github-readme ul li,
      .github-readme ol li::marker {
        color: #e2e8f0;
        font-family: inherit !important;
        font-weight: inherit !important;
        font-size: inherit !important;
      }
    </style>

    {{/* Optional: force dark-mode code highlighting */}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  {{ end }}
{{ end }}